<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Producto - SoundWell</title>
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?display=swap&family=Manrope:wght@400;500;700;800&family=Noto+Sans:wght@400;500;700;900" />
    <script src="https://cdn.tailwindcss.com"></script>

    <script type="module">
      import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

      const supabase = createClient("https://your-project-id.supabase.co", "your-anon-key");

      const params = new URLSearchParams(window.location.search);
      const slug = params.get("producto");

      async function cargarProducto() {
        const { data, error } = await supabase.from("productos").select("*").eq("slug", slug).single();
        if (error || !data) {
          document.getElementById("contenido").innerHTML = "<p class='text-red-500'>Producto no encontrado.</p>";
          return;
        }

        document.getElementById("nombre").textContent = data.nombre;
        document.getElementById("imagen").style.backgroundImage = `url('${data.imagen_url}')`;
        document.getElementById("descripcion").textContent = data.descripcion;
        document.getElementById("categoria").textContent = `Categoría: ${data.categoria}`;

        cargarRelacionados(data.categoria, data.slug);
      }

      async function cargarRelacionados(categoria, slugActual) {
        const { data, error } = await supabase
          .from("productos")
          .select("*")
          .eq("categoria", categoria)
          .neq("slug", slugActual)
          .limit(3);

        if (error || !data.length) return;

        const contenedor = document.getElementById("relacionados");
        data.forEach((p) => {
          const card = document.createElement("a");
          card.href = `producto.html?producto=${p.slug}`;
          card.className = "flex flex-col gap-2 rounded-lg w-52";
          card.innerHTML = `
            <div class="aspect-square rounded-xl bg-cover bg-center" style="background-image: url('${p.imagen_url}')"></div>
            <p class="text-sm font-medium text-[#101418]">${p.nombre}</p>
            <p class="text-xs text-[#5c738a]">${p.descripcion}</p>
          `;
          contenedor.appendChild(card);
        });

        document.getElementById("seccion-relacionados").classList.remove("hidden");
      }

      document.addEventListener("DOMContentLoaded", cargarProducto);
    </script>
  </head>
  <body class="bg-gray-50 text-[#101418]" style="font-family: Manrope, 'Noto Sans', sans-serif;">
    <header class="flex items-center justify-between border-b border-[#eaedf1] px-10 py-3">
      <div class="flex items-center gap-4">
        <div class="size-4">
          <svg viewBox="0 0 48 48" fill="none"><path d="M4 4H17.3334V17.3334H30.6666V30.6666H44V44H4V4Z" fill="currentColor" /></svg>
        </div>
        <h2 class="text-lg font-bold tracking-[-0.015em]">SoundWell</h2>
      </div>
      <div class="flex gap-8 items-center">
        <div class="flex gap-9">
          <a class="text-sm font-medium" href="shop.html">Shop</a>
          <a class="text-sm font-medium" href="#">Learn</a>
          <a class="text-sm font-medium" href="#">Support</a>
        </div>
        <div class="flex gap-2">
          <button class="rounded-full h-10 px-2.5 bg-[#eaedf1] flex items-center">
            <svg width="20" height="20" fill="currentColor" viewBox="0 0 256 256">
              <path d="M229.66,218.34l-50.07-50.06a88.11...Z" />
            </svg>
          </button>
          <button class="rounded-full h-10 px-2.5 bg-[#eaedf1] flex items-center">
            <svg width="20" height="20" fill="currentColor" viewBox="0 0 256 256">
              <path d="M216,40H40A16,16,0...Z" />
            </svg>
          </button>
        </div>
      </div>
    </header>

    <main class="max-w-4xl mx-auto px-6 py-10 space-y-10" id="contenido">
      <div>
        <a href="shop.html" class="inline-block mb-4 text-sm text-blue-500 hover:underline">&larr; Volver al catálogo</a>
        <h1 id="nombre" class="text-3xl font-bold mb-4">Cargando...</h1>
        <div id="imagen" class="aspect-square rounded-xl bg-center bg-cover w-full mb-6"></div>
        <p id="descripcion" class="text-base text-[#101418] mb-4"></p>
        <p id="categoria" class="text-sm text-[#5c738a]"></p>
      </div>

      <div id="seccion-relacionados" class="hidden">
        <h2 class="text-xl font-bold mb-4">También te puede interesar</h2>
        <div id="relacionados" class="flex gap-4 flex-wrap"></div>
      </div>
    </main>
  </body>
</html>
